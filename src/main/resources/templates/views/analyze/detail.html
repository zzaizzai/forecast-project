<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="layout/default_layout">
<div>
    <th:block layout:fragment="content">
        <h2>Analyze Detail Page</h2>
        <h3 th:text="${forecastGroup.getName}"></h3>

        <table>
            <thead>
            <tr>
                <th class="common" colspan="3">Common</th>

                <th colspan="3">Forecast</th>

                <th class="result" colspan="3">Result</th>

            </tr>

            <tr>
                <th class="common">Name</th>
                <th class="common">Unit</th>
                <th class="common">Diff.</th>

                <th>ID</th>
                <th>Updated</th>
                <th>Qty.</th>

                <th class="result">ID</th>
                <th class="result">Updated</th>
                <th class="result">Qty.</th>
            </tr>
            </thead>

            <tbody>
            <tr>
                <!--              Common-->
                <td th:text="${forecastGroup.getName}"></td>
                <!--              Result-->
                <td th:text="${forecastGroup.getId}"></td>
            </tr>

            <tr>
                <!-- TestData-->
                <td>1</td>
                <td>2</td>
                <td>-5</td>
                <td>101010</td>
                <td>101</td>
                <td>2</td>
                <td>101010</td>
                <td>5</td>
                <td>5</td>
            </tr>
            </tbody>

            <tbody>

            <tr th:each="forecast : ${forecasts}">

                <td th:text="${forecast.getName}"></td>
                <td th:text="${forecast.getUnit}"></td>
                <td th:text="${forecast.getDiff}"></td>
                <td th:text="${forecast.getId}"></td>
                <td th:text="${forecast.formattedUpdatedDate}"></td>
                <td th:text="${forecast.formattedQuantity}"></td>
                <!--                <td th:text="${forecast.getResult.getId}"></td>-->
                <!--                <td th:text="${forecast.getResult.formattedUpdatedDate}"></td>-->
                <!--                <td th:text="${forecast.getResult.formattedQuantity}"></td>-->

            </tr>

            </tbody>


        </table>

        <script src="https://cdn.jsdelivr.net/npm/echarts@5.5.1/dist/echarts.min.js"></script>

        <div id="main" style="width: 600px;height:400px;"></div>
        <script th:inline="javascript">
            var forecasts = [[${ forecasts }]]; // Get the list of forecasts from Thymeleaf
            console.log(forecasts)
            // Create arrays for the x-axis (categories) and y-axis (quantities)
            var categories = [];
            var quantities = [];

            // Loop through the forecasts data and populate the arrays
            for (var i = 0; i < forecasts.length; i++) {
                categories.push(forecasts[i].name);  // Assuming forecast.getName() is available
                quantities.push(forecasts[i].quantity);  // Assuming forecast.getFormattedQuantity() is available
            }

            // ECharts configuration
            var myChart = echarts.init(document.getElementById('main'));
            var option = {
                title: {
                    text: 'Forecast Quantities'
                },
                tooltip: {},
                legend: {
                    data: ['Quantity']
                },
                xAxis: {
                    data: categories  // Use the dynamic categories array here
                },
                yAxis: {},
                series: [{
                    name: 'Quantity',
                    type: 'bar',
                    data: quantities  // Use the dynamic quantities array here
                }]
            };
            myChart.setOption(option);
        </script>


    </th:block>
</div>

</html>